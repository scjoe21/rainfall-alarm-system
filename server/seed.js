import dotenv from 'dotenv';
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __dirname = path.dirname(fileURLToPath(import.meta.url));
dotenv.config({ path: path.join(__dirname, '..', '.env') });

import { initDatabase, getDatabase } from './config/database.js';

async function seed() {
  await initDatabase();
  const db = await getDatabase();

  // Clear existing data
  db.exec('DELETE FROM alarm_logs');
  db.exec('DELETE FROM rainfall_forecast');
  db.exec('DELETE FROM rainfall_realtime');
  db.exec('DELETE FROM alarm_settings');
  db.exec('DELETE FROM weather_stations');
  db.exec('DELETE FROM emds');
  db.exec('DELETE FROM districts');
  db.exec('DELETE FROM metros');

  // 광역자치단체
  const metros = [
    [1, '11', '서울특별시'],
    [2, '26', '부산광역시'],
    [3, '27', '대구광역시'],
    [4, '28', '인천광역시'],
    [5, '29', '광주광역시'],
    [6, '30', '대전광역시'],
    [7, '31', '울산광역시'],
    [8, '36', '세종특별자치시'],
    [9, '41', '경기도'],
    [10, '42', '강원특별자치도'],
    [11, '43', '충청북도'],
    [12, '44', '충청남도'],
    [13, '45', '전북특별자치도'],
    [14, '46', '전라남도'],
    [15, '47', '경상북도'],
    [16, '48', '경상남도'],
    [17, '50', '제주특별자치도'],
  ];
  for (const [id, code, name] of metros) {
    db.prepare('INSERT INTO metros (id, code, name) VALUES (?, ?, ?)').run(id, code, name);
  }

  // ====== 기초자치단체 ======
  const allDistricts = [
    // 서울 (25개 구)
    [101,1,'11110','종로구'],[102,1,'11140','중구'],[103,1,'11170','용산구'],
    [104,1,'11200','성동구'],[105,1,'11215','광진구'],[106,1,'11230','동대문구'],
    [107,1,'11260','중랑구'],[108,1,'11290','성북구'],[109,1,'11305','강북구'],
    [110,1,'11320','도봉구'],[111,1,'11350','노원구'],[112,1,'11380','은평구'],
    [113,1,'11410','서대문구'],[114,1,'11440','마포구'],[115,1,'11470','양천구'],
    [116,1,'11500','강서구'],[117,1,'11530','구로구'],[118,1,'11545','금천구'],
    [119,1,'11560','영등포구'],[120,1,'11590','동작구'],[121,1,'11620','관악구'],
    [122,1,'11650','서초구'],[123,1,'11680','강남구'],[124,1,'11710','송파구'],
    [125,1,'11740','강동구'],
    // 부산 (16개 구/군)
    [201,2,'26110','중구'],[202,2,'26140','서구'],[203,2,'26170','동구'],
    [204,2,'26200','영도구'],[205,2,'26230','부산진구'],[206,2,'26260','동래구'],
    [207,2,'26290','남구'],[208,2,'26320','북구'],[209,2,'26350','해운대구'],
    [210,2,'26380','사하구'],[211,2,'26410','금정구'],[212,2,'26440','강서구'],
    [213,2,'26470','연제구'],[214,2,'26500','수영구'],[215,2,'26530','사상구'],
    [216,2,'26710','기장군'],
    // 대구 (8개 구/군)
    [301,3,'27110','중구'],[302,3,'27140','동구'],[303,3,'27170','서구'],
    [304,3,'27200','남구'],[305,3,'27230','북구'],[306,3,'27260','수성구'],
    [307,3,'27290','달서구'],[308,3,'27710','달성군'],
    // 인천 (10개 구/군)
    [401,4,'28110','중구'],[402,4,'28140','동구'],[403,4,'28177','미추홀구'],
    [404,4,'28185','연수구'],[405,4,'28200','남동구'],[406,4,'28237','부평구'],
    [407,4,'28245','계양구'],[408,4,'28260','서구'],[409,4,'28710','강화군'],
    [410,4,'28720','옹진군'],
    // 광주 (5개 구)
    [501,5,'29110','동구'],[502,5,'29140','서구'],[503,5,'29155','남구'],
    [504,5,'29170','북구'],[505,5,'29200','광산구'],
    // 대전 (5개 구)
    [601,6,'30110','동구'],[602,6,'30140','중구'],[603,6,'30170','서구'],
    [604,6,'30200','유성구'],[605,6,'30230','대덕구'],
    // 울산 (5개 구/군)
    [701,7,'31110','중구'],[702,7,'31140','남구'],[703,7,'31170','동구'],
    [704,7,'31200','북구'],[705,7,'31710','울주군'],
    // 세종 (세종시 자체가 기초자치단체 역할 - 읍면동으로 나눔)
    [801,8,'36110','조치원읍'],[802,8,'36120','연기면'],[803,8,'36130','연동면'],
    [804,8,'36140','부강면'],[805,8,'36150','금남면'],[806,8,'36160','장군면'],
    [807,8,'36170','연서면'],[808,8,'36180','전의면'],[809,8,'36190','전동면'],
    [810,8,'36200','소정면'],[811,8,'36310','한솔동'],[812,8,'36320','새롬동'],
    [813,8,'36330','도담동'],[814,8,'36340','아름동'],[815,8,'36350','종촌동'],
    [816,8,'36360','고운동'],[817,8,'36370','보람동'],[818,8,'36380','대평동'],
    [819,8,'36390','소담동'],[820,8,'36400','반곡동'],
    [821,8,'36410','다정동'],[822,8,'36420','해밀동'],[823,8,'36430','나성동'],[824,8,'36440','어진동'],
    // 경기도 (31개 시/군)
    [901,9,'41111','수원시 장안구'],[902,9,'41113','수원시 권선구'],[903,9,'41115','수원시 팔달구'],
    [904,9,'41117','수원시 영통구'],[905,9,'41131','성남시 수정구'],[906,9,'41133','성남시 중원구'],
    [907,9,'41135','성남시 분당구'],[908,9,'41150','의정부시'],[909,9,'41170','안양시 만안구'],
    [910,9,'41173','안양시 동안구'],[911,9,'41190','부천시'],[912,9,'41210','광명시'],
    [913,9,'41220','평택시'],[914,9,'41250','동두천시'],[915,9,'41270','안산시 상록구'],
    [916,9,'41273','안산시 단원구'],[917,9,'41280','고양시 덕양구'],[918,9,'41281','고양시 일산동구'],
    [919,9,'41285','고양시 일산서구'],[920,9,'41290','과천시'],[921,9,'41310','구리시'],
    [922,9,'41360','남양주시'],[923,9,'41370','오산시'],[924,9,'41390','시흥시'],
    [925,9,'41410','군포시'],[926,9,'41430','의왕시'],[927,9,'41450','하남시'],
    [928,9,'41460','용인시 처인구'],[929,9,'41461','용인시 기흥구'],[930,9,'41463','용인시 수지구'],
    [931,9,'41480','파주시'],[932,9,'41500','이천시'],[933,9,'41550','안성시'],
    [934,9,'41570','김포시'],[935,9,'41590','화성시'],[936,9,'41610','광주시'],
    [937,9,'41630','양주시'],[938,9,'41650','포천시'],[939,9,'41670','여주시'],
    [940,9,'41800','연천군'],[941,9,'41820','가평군'],[942,9,'41830','양평군'],
    // 강원 (18개 시/군)
    [1001,10,'42110','춘천시'],[1002,10,'42130','원주시'],[1003,10,'42150','강릉시'],
    [1004,10,'42170','동해시'],[1005,10,'42190','태백시'],[1006,10,'42210','속초시'],
    [1007,10,'42230','삼척시'],[1008,10,'42720','홍천군'],[1009,10,'42730','횡성군'],
    [1010,10,'42750','영월군'],[1011,10,'42760','평창군'],[1012,10,'42770','정선군'],
    [1013,10,'42780','철원군'],[1014,10,'42790','화천군'],[1015,10,'42800','양구군'],
    [1016,10,'42810','인제군'],[1017,10,'42820','고성군'],[1018,10,'42830','양양군'],
    // 충북 (12개 시/군)
    [1101,11,'43110','청주시 상당구'],[1102,11,'43111','청주시 서원구'],
    [1103,11,'43112','청주시 흥덕구'],[1104,11,'43113','청주시 청원구'],
    [1105,11,'43130','충주시'],[1106,11,'43150','제천시'],[1107,11,'43720','보은군'],
    [1108,11,'43730','옥천군'],[1109,11,'43740','영동군'],[1110,11,'43745','증평군'],
    [1111,11,'43750','진천군'],[1112,11,'43760','괴산군'],[1113,11,'43770','음성군'],
    [1114,11,'43800','단양군'],
    // 충남 (15개 시/군)
    [1201,12,'44130','천안시 동남구'],[1202,12,'44131','천안시 서북구'],
    [1203,12,'44150','공주시'],[1204,12,'44180','보령시'],[1205,12,'44200','아산시'],
    [1206,12,'44210','서산시'],[1207,12,'44230','논산시'],[1208,12,'44250','계룡시'],
    [1209,12,'44270','당진시'],[1210,12,'44710','금산군'],[1211,12,'44760','부여군'],
    [1212,12,'44770','서천군'],[1213,12,'44790','청양군'],[1214,12,'44800','홍성군'],
    [1215,12,'44810','예산군'],[1216,12,'44825','태안군'],
    // 전북 (14개 시/군)
    [1301,13,'45110','전주시 완산구'],[1302,13,'45113','전주시 덕진구'],
    [1303,13,'45130','군산시'],[1304,13,'45140','익산시'],[1305,13,'45180','정읍시'],
    [1306,13,'45190','남원시'],[1307,13,'45210','김제시'],[1308,13,'45710','완주군'],
    [1309,13,'45720','진안군'],[1310,13,'45730','무주군'],[1311,13,'45740','장수군'],
    [1312,13,'45750','임실군'],[1313,13,'45770','순창군'],[1314,13,'45790','고창군'],
    [1315,13,'45800','부안군'],
    // 전남 (22개 시/군)
    [1401,14,'46110','목포시'],[1402,14,'46130','여수시'],[1403,14,'46150','순천시'],
    [1404,14,'46170','나주시'],[1405,14,'46230','광양시'],[1406,14,'46710','담양군'],
    [1407,14,'46720','곡성군'],[1408,14,'46730','구례군'],[1409,14,'46770','고흥군'],
    [1410,14,'46780','보성군'],[1411,14,'46790','화순군'],[1412,14,'46800','장흥군'],
    [1413,14,'46810','강진군'],[1414,14,'46820','해남군'],[1415,14,'46830','영암군'],
    [1416,14,'46840','무안군'],[1417,14,'46860','함평군'],[1418,14,'46870','영광군'],
    [1419,14,'46880','장성군'],[1420,14,'46890','완도군'],[1421,14,'46900','진도군'],
    [1422,14,'46910','신안군'],
    // 경북 (23개 시/군)
    [1501,15,'47110','포항시 남구'],[1502,15,'47111','포항시 북구'],
    [1503,15,'47130','경주시'],[1504,15,'47150','김천시'],[1505,15,'47170','안동시'],
    [1506,15,'47190','구미시'],[1507,15,'47210','영주시'],[1508,15,'47230','영천시'],
    [1509,15,'47250','상주시'],[1510,15,'47280','문경시'],[1511,15,'47290','경산시'],
    [1512,15,'47720','군위군'],[1513,15,'47730','의성군'],[1514,15,'47750','청송군'],
    [1515,15,'47760','영양군'],[1516,15,'47770','영덕군'],[1517,15,'47820','청도군'],
    [1518,15,'47830','고령군'],[1519,15,'47840','성주군'],[1520,15,'47850','칠곡군'],
    [1521,15,'47900','예천군'],[1522,15,'47920','봉화군'],[1523,15,'47930','울진군'],
    [1524,15,'47940','울릉군'],
    // 경남 (18개 시/군)
    [1601,16,'48120','창원시 의창구'],[1602,16,'48121','창원시 성산구'],
    [1603,16,'48123','창원시 마산합포구'],[1604,16,'48125','창원시 마산회원구'],
    [1605,16,'48127','창원시 진해구'],[1606,16,'48170','진주시'],
    [1607,16,'48220','통영시'],[1608,16,'48240','사천시'],[1609,16,'48250','김해시'],
    [1610,16,'48270','밀양시'],[1611,16,'48310','거제시'],[1612,16,'48330','양산시'],
    [1613,16,'48720','의령군'],[1614,16,'48730','함안군'],[1615,16,'48740','창녕군'],
    [1616,16,'48820','고성군'],[1617,16,'48840','남해군'],[1618,16,'48850','하동군'],
    [1619,16,'48860','산청군'],[1620,16,'48870','함양군'],[1621,16,'48880','거창군'],
    [1622,16,'48890','합천군'],
    // 제주 (2개 시)
    [1701,17,'50110','제주시'],[1702,17,'50130','서귀포시'],
  ];

  for (const [id, metro_id, code, name] of allDistricts) {
    db.prepare('INSERT INTO districts (id, metro_id, code, name) VALUES (?, ?, ?, ?)').run(id, metro_id, code, name);
  }

  // ====== 읍면동 시드 ======
  const emds = [
    // 종로구
    [10001,101,'1111010100','청운효자동'],[10002,101,'1111010200','사직동'],
    [10003,101,'1111010300','삼청동'],[10004,101,'1111010400','부암동'],
    [10005,101,'1111010500','평창동'],[10006,101,'1111010600','무악동'],
    [10007,101,'1111010700','교남동'],[10008,101,'1111011100','가회동'],
    [10009,101,'1111011500','종로1·2·3·4가동'],[10010,101,'1111011800','종로5·6가동'],
    [10011,101,'1111012100','이화동'],[10012,101,'1111012500','혜화동'],
    [10013,101,'1111013000','창신1동'],[10014,101,'1111013100','창신2동'],
    [10015,101,'1111013200','창신3동'],[10016,101,'1111013300','숭인1동'],
    [10017,101,'1111013400','숭인2동'],
    // 강남구
    [20001,123,'1168010100','신사동'],[20002,123,'1168010200','논현1동'],
    [20003,123,'1168010300','논현2동'],[20004,123,'1168010400','압구정동'],
    [20005,123,'1168010500','청담동'],[20006,123,'1168010600','삼성1동'],
    [20007,123,'1168010700','삼성2동'],[20008,123,'1168010800','대치1동'],
    [20009,123,'1168010900','대치2동'],[20010,123,'1168011300','역삼1동'],
    [20011,123,'1168011400','역삼2동'],[20012,123,'1168011500','도곡1동'],
    [20013,123,'1168011600','도곡2동'],[20014,123,'1168011700','개포1동'],
    [20015,123,'1168011800','개포2동'],[20016,123,'1168012100','일원본동'],
    [20017,123,'1168012200','일원1동'],[20018,123,'1168012300','일원2동'],
    [20019,123,'1168012400','수서동'],[20020,123,'1168012500','세곡동'],
    // 해운대구
    [30001,209,'2635010100','우1동'],[30002,209,'2635010200','우2동'],
    [30003,209,'2635010300','우3동'],[30004,209,'2635010400','중1동'],
    [30005,209,'2635010500','중2동'],[30006,209,'2635010600','좌1동'],
    [30007,209,'2635010700','좌2동'],[30008,209,'2635010800','좌3동'],
    [30009,209,'2635010900','좌4동'],[30010,209,'2635011000','송정동'],
    [30011,209,'2635011100','반여1동'],[30012,209,'2635011200','반여2동'],
    [30013,209,'2635011300','반여3동'],[30014,209,'2635011400','반여4동'],
    [30015,209,'2635011500','반송1동'],[30016,209,'2635011600','반송2동'],
    [30017,209,'2635011700','재송1동'],[30018,209,'2635011800','재송2동'],
    // 세종 조치원읍
    [40001,801,'3611010100','조치원읍'],[40002,802,'3612010100','연기면'],
    [40003,803,'3613010100','연동면'],[40004,804,'3614010100','부강면'],
    [40005,805,'3615010100','금남면'],[40006,806,'3616010100','장군면'],
    [40007,807,'3617010100','연서면'],[40008,808,'3618010100','전의면'],
    [40009,809,'3619010100','전동면'],[40010,810,'3620010100','소정면'],
    [40011,811,'3631010100','한솔동'],[40012,812,'3632010100','새롬동'],
    [40013,813,'3633010100','도담동'],[40014,814,'3634010100','아름동'],
    [40015,815,'3635010100','종촌동'],[40016,816,'3636010100','고운동'],
    [40017,817,'3637010100','보람동'],[40018,818,'3638010100','대평동'],
    [40019,819,'3639010100','소담동'],[40020,820,'3640010100','반곡동'],
    // 제주시
    [50001,1701,'5011010100','일도1동'],[50002,1701,'5011010200','일도2동'],
    [50003,1701,'5011010300','이도1동'],[50004,1701,'5011010400','이도2동'],
    [50005,1701,'5011010500','삼도1동'],[50006,1701,'5011010600','삼도2동'],
    [50007,1701,'5011010700','용담1동'],[50008,1701,'5011010800','용담2동'],
    [50009,1701,'5011011100','건입동'],[50010,1701,'5011011200','화북동'],
    [50011,1701,'5011011300','삼양동'],[50012,1701,'5011011400','봉개동'],
    [50013,1701,'5011011500','아라동'],[50014,1701,'5011011600','오라동'],
    [50015,1701,'5011011700','연동'],[50016,1701,'5011011800','노형동'],
    [50017,1701,'5011011900','외도동'],[50018,1701,'5011012000','이호동'],
    [50019,1701,'5011012100','도두동'],
    // 광산구 (광주)
    [60001,505,'2920010100','송정1동'],[60002,505,'2920010200','송정2동'],
    [60003,505,'2920010300','도산동'],[60004,505,'2920010400','수완동'],
    [60005,505,'2920010500','하남동'],[60006,505,'2920010600','첨단동'],
    [60007,505,'2920010700','월곡동'],[60008,505,'2920010800','운남동'],
    [60009,505,'2920010900','산월동'],[60010,505,'2920011000','비아동'],
    [60011,505,'2920011100','본량동'],[60012,505,'2920011200','임곡동'],
    [60013,505,'2920011300','우산동'],[60014,505,'2920011400','동곡동'],
    [60015,505,'2920011500','어룡동'],[60016,505,'2920011600','평동'],
    [60017,505,'2920011700','삼도동'],[60018,505,'2920011800','신가동'],
    [60019,505,'2920011900','신창동'],[60020,505,'2920012000','선운동'],
    [60021,505,'2920012100','소촌동'],
    // 서귀포시
    [50101,1702,'5013010100','송산동'],[50102,1702,'5013010200','정방동'],
    [50103,1702,'5013010300','중앙동'],[50104,1702,'5013010400','천지동'],
    [50105,1702,'5013010500','효돈동'],[50106,1702,'5013010600','영천동'],
    [50107,1702,'5013010700','동홍동'],[50108,1702,'5013010800','서홍동'],
    [50109,1702,'5013010900','대륜동'],[50110,1702,'5013011000','대천동'],
    [50111,1702,'5013011100','중문동'],[50112,1702,'5013011200','예래동'],
  ];
  for (const [id, district_id, code, name] of emds) {
    db.prepare('INSERT INTO emds (id, district_id, code, name) VALUES (?, ?, ?, ?)').run(id, district_id, code, name);
  }

  // ====== 관측소 ======
  const stations = [
    // 종로구
    [1,'401','서울',37.5714,126.9658,10009],
    [2,'509','북악산',37.5944,126.9783,10004],
    [3,'510','청운동',37.5870,126.9668,10001],
    [4,'511','삼청동',37.5870,126.9830,10003],
    [5,'512','평창동',37.6100,126.9750,10005],
    // 강남구
    [10,'400','강남',37.5133,127.0420,20010],
    [11,'520','신사동',37.5237,127.0230,20001],
    [12,'521','삼성동',37.5105,127.0600,20006],
    [13,'522','대치동',37.4940,127.0570,20008],
    [14,'523','수서동',37.4870,127.1010,20019],
    // 해운대구
    [20,'159','부산',35.1046,129.0319,30004],
    [21,'959','해운대',35.1630,129.1640,30001],
    [22,'960','송정',35.1785,129.2000,30010],
    [23,'961','반여동',35.1840,129.1310,30011],
    [24,'962','재송동',35.1700,129.1110,30017],
    // 세종
    [30,'360','세종',36.4800,127.2590,40011],
    [31,'861','조치원',36.6010,127.0010,40001],
    [32,'862','연기',36.5560,127.0340,40002],
    [33,'863','부강',36.5270,127.1440,40004],
    [34,'864','금남',36.4700,127.0800,40005],
    // 광산구
    [60,'156','광주',35.1731,126.8915,60004],
    [61,'723','송정',35.1390,126.7920,60001],
    [62,'724','첨단',35.1930,126.8480,60006],
    [63,'725','하남',35.1550,126.8350,60005],
    [64,'726','평동',35.1280,126.8100,60016],
    [65,'727','비아',35.1850,126.8050,60010],
    // 제주시
    [40,'184','제주',33.5140,126.5298,50015],
    [41,'185','고산',33.2940,126.1628,50019],
    [42,'786','화북',33.5250,126.5700,50010],
    [43,'787','삼양',33.5280,126.5900,50011],
    // 서귀포시
    [50,'189','서귀포',33.2461,126.5653,50101],
    [51,'188','성산',33.3870,126.8800,50105],
    [52,'793','중문',33.2540,126.4120,50111],
  ];
  for (const [id, stn_id, name, lat, lon, emd_id] of stations) {
    db.prepare('INSERT INTO weather_stations (id, stn_id, name, lat, lon, emd_id) VALUES (?, ?, ?, ?, ?, ?)').run(id, stn_id, name, lat, lon, emd_id);
  }

  const districtCount = allDistricts.length;
  console.log('Seed data inserted successfully!');
  console.log(`  Metros: ${metros.length}`);
  console.log(`  Districts: ${districtCount}`);
  console.log(`  EMDs: ${emds.length}`);
  console.log(`  Stations: ${stations.length}`);

  await seedFromGeoJSON();
}

function sqlStr(s) {
  return "'" + String(s).replace(/'/g, "''") + "'";
}

function centroid(geometry) {
  let allPts = [];
  if (geometry.type === 'Polygon') {
    const ring = geometry.coordinates[0];
    allPts = ring.slice(0, ring.length - 1);
  } else if (geometry.type === 'MultiPolygon') {
    for (const poly of geometry.coordinates) {
      const ring = poly[0];
      allPts.push(...ring.slice(0, ring.length - 1));
    }
  }
  if (!allPts.length) return null;
  const sumLon = allPts.reduce((s, p) => s + p[0], 0);
  const sumLat = allPts.reduce((s, p) => s + p[1], 0);
  return [sumLat / allPts.length, sumLon / allPts.length]; // [lat, lon]
}

async function seedFromGeoJSON() {
  const db = await getDatabase();

  // Districts that already have EMDs
  const seededRows = db.prepare('SELECT DISTINCT district_id FROM emds').all();
  const seededDistrictIds = new Set(seededRows.map(r => r.district_id));

  const districts = db.prepare('SELECT id, code, name FROM districts').all();

  let emdIdCounter = 100001;
  let stnCounter = 1000;
  const sqlParts = [];
  let insertedCount = 0;

  for (const district of districts) {
    if (seededDistrictIds.has(district.id)) continue;

    const geoPath = path.join(__dirname, '..', 'data', 'geojson', `${district.code}.json`);
    if (!fs.existsSync(geoPath)) continue;

    let geojson;
    try {
      geojson = JSON.parse(fs.readFileSync(geoPath, 'utf-8'));
    } catch (e) {
      console.warn(`Failed to parse ${geoPath}: ${e.message}`);
      continue;
    }

    if (!geojson.features) continue;

    for (const feature of geojson.features) {
      const emdCode = feature.properties?.EMD_CD;
      const emdName = feature.properties?.EMD_NM;
      if (!emdCode || !emdName) continue;

      const center = centroid(feature.geometry);
      if (!center) continue;
      const [lat, lon] = center;

      const emdId = emdIdCounter++;
      const stnId = 'S' + stnCounter++;

      sqlParts.push(
        `INSERT OR IGNORE INTO emds (id, district_id, code, name) VALUES (${emdId}, ${district.id}, ${sqlStr(emdCode)}, ${sqlStr(emdName)});`
      );
      sqlParts.push(
        `INSERT OR IGNORE INTO weather_stations (stn_id, name, lat, lon, emd_id) VALUES (${sqlStr(stnId)}, ${sqlStr(emdName)}, ${lat}, ${lon}, ${emdId});`
      );
      insertedCount++;
    }
  }

  if (sqlParts.length === 0) {
    console.log('seedFromGeoJSON: nothing to insert (all districts already seeded)');
    return;
  }

  const sql = 'BEGIN TRANSACTION;\n' + sqlParts.join('\n') + '\nCOMMIT;';
  db.exec(sql);
  console.log(`seedFromGeoJSON: inserted ${insertedCount} EMDs with stations from GeoJSON`);
}

seed().catch(console.error);
